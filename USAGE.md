# Running the ToppFun → aPEAR Pathway Clustering Pipeline

This guide provides a step-by-step walkthrough showing how to prepare inputs, run the pipeline, and interpret outputs generated by:

```r
run_toppfun_apear_pipeline()
```

## 1. Setup ##

Install required packages:
```r
install.packages(c("dplyr", "ggplot2"))
```

Download aPEAR 1.0.0 from the CRAN archive:
https://cran.r-project.org/src/contrib/Archive/aPEAR/

Then install it from the downloaded tarball (example assumes it’s in ~/Downloads/):

```r
install.packages("~/Downloads/aPEAR_1.0.0.tar.gz", repos = NULL, type = "source")
```

Source the wrapper script that contains the pipeline function:

```r
source("toppfun_apear_wrapper.R")
```

## 2. Input Requirements ##

Allowed input format:

.txt file (ToppFun default) downloaded using the “Download All” option from the ToppFun results page.

The filename (without .txt) should match the result_of_interest argument.

Example:

File on disk: Demo_ToppFun_Analysis.txt

In the function call: result_of_interest = "Demo_ToppFun_Analysis"


## 3. Running the Pipeline ##

Copy toppfun_apear_wrapper.R into your working directory (or source it from wherever you store it), then modify and run the following block:

```r
run_toppfun_apear_pipeline(
  result_of_interest = "Demo_ToppFun_Analysis",  # same name as the ToppFun txt file w/o .txt
  toppfun_result_directory = "example_data/toppfun_results/",
  output_directory = "example_output/aPEAR_clusters/",
  excluded_toppfun_category = c(
    "Cytoband", "ToppCell Atlas", "Disease", "Gene Family",
    "MicroRNA", "Drug", "Coexpression Atlas", "Computational"
  ),
  colorBy_pval = FALSE
)

```

Outputs (cleaned inputs, clustering results, and network plots) will be written into:

```
example_output/aPEAR_clusters/Demo_ToppFun_Analysis/
```

## 4. Coloring Options ##

Option A — Color Nodes by P-Value

Set:

```r
colorBy_pval = TRUE
```

Node color interpretation:

Red → smaller p-values (more significant)

Blue → larger p-values (less significant)

Option B — Single-color Nodes

```r
colorBy_pval = FALSE
default_nodecolor = "steelblue"   # (customizable)
```

All nodes will use the same color and the color legend is removed.



## 5. Citations ##

If you use this workflow, please cite:

aPEAR

Kerseviciute I and Gordevicius J. aPEAR: an R package for autonomous visualization of pathway enrichment networks.
https://github.com/kerseviciute/aPEAR

ToppFun

Chen J., et al. ToppGene Suite for gene list enrichment analysis and candidate gene prioritization
https://toppgene.cchmc.org/enrichment.jsp